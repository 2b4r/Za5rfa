<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Miniâ€‘Nation â€” SVG Map</title>
<style>
  :root{--bg:#0f172a;--panel:#0b1220;--muted:#94a3b8;--border:#1f2937;--p:#06b6d4;--ai:#f43f5e;--n:#64748b;}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:#fff;font:15px/1.5 system-ui,Segoe UI,Arial}
  header{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid var(--border);backdrop-filter:blur(8px);position:sticky;top:0;background:#0f172acc}
  .pill{background:#0b1220;border:1px solid var(--border);border-radius:999px;padding:4px 10px;color:#cbd5e1;font-size:12px}
  .wrap{max-width:1100px;margin:0 auto;padding:12px;display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:1000px){.wrap{grid-template-columns:680px 1fr}}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:12px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{border:1px solid var(--border);background:#142033;color:#dbeafe;border-radius:10px;padding:8px 10px;cursor:pointer}
  .btn:hover{filter:brightness(1.08)} .btn:disabled{opacity:.5;cursor:not-allowed}
  svg{width:100%;height:auto;border:1px solid var(--border);border-radius:14px;background:linear-gradient(#0b1426,#0a1630)}
  .reg{stroke:#0f273f;stroke-width:2}
  .reg.sel{filter:drop-shadow(0 0 6px #fff6)}
  .lbl{font:700 12px system-ui;fill:#e2e8f0;pointer-events:none}
  .hint{font-size:12px;color:#9fb9d6}
</style>
</head>
<body>
<header>
  <div class="row">
    <span class="pill">ğŸ—ºï¸ Miniâ€‘Nation (SVG)</span>
  </div>
  <div class="row">
    <span id="turnPill" class="pill">Ø§Ù„Ø¯ÙˆØ±: 1</span>
    <span id="ownPill"  class="pill">Ø£Ù‚Ø§Ù„ÙŠÙ…Ùƒ: â€”</span>
    <span id="goldPill" class="pill">Ø§Ù„Ø°Ù‡Ø¨: â€”</span>
  </div>
</header>

<div class="wrap">
  <!-- Ø®Ø±ÙŠØ·Ø© SVG Ø¨Ø£Ù‚Ø§Ù„ÙŠÙ… (9 Ø£Ù‚Ø§Ù„ÙŠÙ… Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø¨Ù„Ø§Ø·Ø§Øª ØºÙŠØ± Ù…Ù†ØªØ¸Ù…Ø© + Ø­Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙƒØ©) -->
  <svg id="map" viewBox="0 0 680 480" xmlns="http://www.w3.org/2000/svg" aria-label="map">
    <!-- ØµÙ Ø¹Ù„ÙˆÙŠ -->
    <path id="r0" class="reg" d="M20,20 L220,20 L210,100 L40,120 Z"/>
    <path id="r1" class="reg" d="M220,20 L440,20 L460,110 L210,100 Z"/>
    <path id="r2" class="reg" d="M440,20 L660,20 L640,120 L460,110 Z"/>
    <!-- ØµÙ ÙˆØ³Ø· -->
    <path id="r3" class="reg" d="M40,120 L210,100 L230,240 L60,250 Z"/>
    <path id="r4" class="reg" d="M210,100 L460,110 L470,250 L230,240 Z"/>
    <path id="r5" class="reg" d="M460,110 L640,120 L620,260 L470,250 Z"/>
    <!-- ØµÙ Ø³ÙÙ„ÙŠ -->
    <path id="r6" class="reg" d="M60,250 L230,240 L220,420 L40,400 Z"/>
    <path id="r7" class="reg" d="M230,240 L470,250 L480,420 L220,420 Z"/>
    <path id="r8" class="reg" d="M470,250 L620,260 L640,460 L480,420 Z"/>
    <!-- Labels -->
    <g id="labels" >
      <text class="lbl" x="110" y="80">0</text>
      <text class="lbl" x="330" y="80">0</text>
      <text class="lbl" x="550" y="80">0</text>
      <text class="lbl" x="120" y="190">0</text>
      <text class="lbl" x="340" y="190">0</text>
      <text class="lbl" x="540" y="200">0</text>
      <text class="lbl" x="120" y="330">0</text>
      <text class="lbl" x="340" y="340">0</text>
      <text class="lbl" x="560" y="360">0</text>
    </g>
  </svg>

  <div class="panel">
    <h3>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
    <div id="info" class="hint">Ø§Ø¶ØºØ· Ø¥Ù‚Ù„ÙŠÙ… ØªÙ…Ù„ÙƒÙ‡ Ù„ØªØ­Ø¯ÙŠØ¯Ù‡ØŒ Ø«Ù… Ø§Ø¶ØºØ· Ø¥Ù‚Ù„ÙŠÙ…Ù‹Ø§ Ù…Ø¬Ø§ÙˆØ±Ù‹Ø§ Ù„Ù„Ù‡Ø¬ÙˆÙ….</div>
    <div class="row" style="margin:8px 0">
      <button id="btnTrain"  class="btn">ØªØ¯Ø±ÙŠØ¨ +2 (5ğŸ’°)</button>
      <button id="btnInvest" class="btn">Ø§Ø³ØªØ«Ù…Ø§Ø± +1 ØµÙ†Ø§Ø¹Ø© (6ğŸ’°)</button>
      <button id="btnAttack" class="btn" disabled>Ù‡Ø¬ÙˆÙ…</button>
      <button id="btnEnd"    class="btn">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ±</button>
      <button id="btnNew"    class="btn">Ø¨Ø¯Ø§ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>
    <div class="row">
      <div class="pill">ğŸ–ï¸ Ù‚ÙˆØ§Øª: <b id="stTroops">â€”</b></div>
      <div class="pill">ğŸ­ ØµÙ†Ø§Ø¹Ø©: <b id="stInd">â€”</b></div>
      <div class="pill">ğŸ›¡ï¸ Ø¯ÙØ§Ø¹: <b id="stDef">â€”</b></div>
      <div class="pill">ğŸ‘¥ Ø³ÙƒØ§Ù†: <b id="stPop">â€”</b></div>
    </div>
    <p id="log" class="hint" style="margin-top:8px">Ø¬Ø§Ù‡Ø².</p>
  </div>

  <div class="panel">
    <h3>Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ù…</h3>
    <div class="row">
      <div class="pill" style="background:#062532;border-color:#0c445a">Ø£Ù†Øª: <b id="pOwn">â€”</b></div>
      <div class="pill" style="background:#2a0e16;border-color:#5a0c1d">Ø§Ù„Ø®ØµÙ…: <b id="aOwn">â€”</b></div>
      <div class="pill" style="background:#1f2937;border-color:#0f273f">Ù…Ø­Ø§ÙŠØ¯: <b id="nOwn">â€”</b></div>
    </div>
  </div>
</div>

<script>
(() => {
  // ===== Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ù„ÙƒÙŠØ© =====
  const COL_P='var(--p)', COL_A='var(--ai)', COL_N='var(--n)';

  // ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù‚Ø§Ù„ÙŠÙ… (9) Ùˆ Ø§Ù„Ø¬ÙˆØ§Ø± (Ù…Ø´ØªØ±ÙÙƒ Ø­Ø¯ÙˆØ¯) =====
  const regs=[...document.querySelectorAll('.reg')];
  const lbls=[...document.querySelectorAll('#labels .lbl')]; // Ù„ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ù‚ÙˆØ§Øª
  const adj = {
    0:[1,3], 1:[0,2,4], 2:[1,5],
    3:[0,4,6],4:[1,3,5,7],5:[2,4,8],
    6:[3,7], 7:[4,6,8], 8:[5,7]
  };

  // owner: 0 player, 1 AI, 2 neutral
  let prov = Array.from({length:9}, (_,i)=>({
    owner: i%3===0?0 : (i%3===1?1:2),
    troops: 2 + (i%3===0?2:0),
    ind: (i%4===0)?2:1,
    def: (i%5===0)?2:1,
    pop: 2 + (i%3===2?1:0)
  }));

  // Ø§Ù‚ØªØµØ§Ø¯
  let goldP=14, goldA=14, turn=1;

  // Ø§Ø®ØªÙŠØ§Ø±
  let from=null, to=null;

  // UI refs
  const info=document.getElementById('info'), log=document.getElementById('log');
  const turnPill=document.getElementById('turnPill'), ownPill=document.getElementById('ownPill'), goldPill=document.getElementById('goldPill');
  const pOwn=document.getElementById('pOwn'), aOwn=document.getElementById('aOwn'), nOwn=document.getElementById('nOwn');
  const stTroops=document.getElementById('stTroops'), stInd=document.getElementById('stInd'), stDef=document.getElementById('stDef'), stPop=document.getElementById('stPop');
  const btnTrain=document.getElementById('btnTrain'), btnInvest=document.getElementById('btnInvest'), btnAttack=document.getElementById('btnAttack'), btnEnd=document.getElementById('btnEnd'), btnNew=document.getElementById('btnNew');

  // ===== Ø£Ø¯ÙˆØ§Øª =====
  function counts(){
    let cP=0,cA=0,cN=0;
    for(const p of prov){ if(p.owner===0)cP++; else if(p.owner===1)cA++; else cN++; }
    return {cP,cA,cN};
  }
  function income(owner){
    let s=0; for(const p of prov) if(p.owner===owner) s += (p.ind + p.pop); return s;
  }
  function setFill(i){
    regs[i].style.fill = prov[i].owner===0? getComputedStyle(document.documentElement).getPropertyValue('--p')
      : prov[i].owner===1? getComputedStyle(document.documentElement).getPropertyValue('--ai')
      : getComputedStyle(document.documentElement).getPropertyValue('--n');
  }
  function refresh(){
    regs.forEach((r,i)=>{ setFill(i); r.classList.remove('sel'); lbls[i].textContent = prov[i].troops; });
    if(from!=null) regs[from].classList.add('sel');
    if(to!=null) regs[to].classList.add('sel');
    const {cP,cA,cN}=counts();
    pOwn.textContent=cP; aOwn.textContent=cA; nOwn.textContent=cN;
    ownPill.textContent='Ø£Ù‚Ø§Ù„ÙŠÙ…Ùƒ: '+cP;
    goldPill.textContent='Ø§Ù„Ø°Ù‡Ø¨: '+goldP;
    turnPill.textContent='Ø§Ù„Ø¯ÙˆØ±: '+turn;
    updateButtons();
    showStats(from ?? to ?? 0);
  }
  function showStats(i){
    const p=prov[i]||{troops:'â€”',ind:'â€”',def:'â€”',pop:'â€”'};
    stTroops.textContent=p.troops; stInd.textContent=p.ind; stDef.textContent=p.def; stPop.textContent=p.pop;
  }
  function updateButtons(){
    btnTrain.disabled = !(from!=null && prov[from].owner===0 && goldP>=5);
    btnInvest.disabled= !(from!=null && prov[from].owner===0 && goldP>=6);
    btnAttack.disabled = !(from!=null && to!=null && prov[from].owner===0 && prov[to].owner!==0 && adj[from].includes(to) && prov[from].troops>=2);
  }
  function logMsg(s){ log.textContent=s; }

  // ===== ØªÙØ§Ø¹Ù„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© =====
  regs.forEach((el,i)=>{
    el.addEventListener('click', ()=>{
      if(from==null){
        if(prov[i].owner!==0){ logMsg('Ø§Ø®ØªØ± Ø¥Ù‚Ù„ÙŠÙ… ØªÙ…Ù„ÙƒÙ‡.'); return; }
        from=i; to=null; info.textContent='Ø§Ø®ØªØ± Ø¬Ø§Ø±Ù‹Ø§ Ù„Ù„ØªØ±ÙƒÙŠØ²/Ø§Ù„Ù‡Ø¬ÙˆÙ… Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… ØªØ¯Ø±ÙŠØ¨/Ø§Ø³ØªØ«Ù…Ø§Ø±.'; showStats(i);
      }else if(to==null){
        if(i===from){ from=null; to=null; info.textContent='ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯.'; }
        else if(adj[from].includes(i)){ to=i; showStats(i); info.textContent = (prov[i].owner===0)? 'Ø¬Ø§Ø±Ù ØªØ§Ø¨Ø¹ Ù„Ùƒ.' : 'Ø¬Ø§Ø±Ù Ø¹Ø¯Ùˆ/Ù…Ø­Ø§ÙŠØ¯ â€” Ø¬Ø§Ù‡Ø² Ù„Ù„Ù‡Ø¬ÙˆÙ….'; }
        else { logMsg('Ù‡Ø°Ø§ Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ… Ù„ÙŠØ³ Ù…Ø¬Ø§ÙˆØ±Ù‹Ø§ Ù„Ù„Ù…ØµØ¯Ø±.'); }
      }else{
        // Ø¥Ø°Ø§ ÙƒØ§Ù† already from & toØŒ Ø§Ù„Ø¶ØºØ· ÙŠØºÙŠÙ‘Ø± Ø§Ù„Ù…ØµØ¯Ø± Ù„Ùˆ Ù…Ù„ÙƒÙƒ
        if(prov[i].owner===0){ from=i; to=null; showStats(i); }
        else { to=i; showStats(i); }
      }
      refresh();
    });
  });

  // ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª =====
  btnTrain.onclick=()=>{
    if(from==null) return;
    const p=prov[from]; if(p.owner!==0||goldP<5) return;
    p.troops+=2; goldP-=5; logMsg('ØªØ¯Ø±ÙŠØ¨ +2 Ù‚ÙˆØ§Øª.'); refresh();
  };
  btnInvest.onclick=()=>{
    if(from==null) return;
    const p=prov[from]; if(p.owner!==0||goldP<6) return;
    p.ind+=1; goldP-=6; logMsg('Ø§Ø³ØªØ«Ù…Ø§Ø± +1 ØµÙ†Ø§Ø¹Ø©.'); refresh();
  };
  btnAttack.onclick=()=>{
    if(!(from!=null&&to!=null)) return;
    const A=prov[from], D=prov[to];
    if(A.owner!==0||D.owner===0||!adj[from].includes(to)) return;
    const send=Math.max(1, Math.floor(A.troops/2));
    A.troops-=send;
    const atk = send*(1+0.15*A.ind)*(0.85+Math.random()*0.3);
    const def = D.troops*(1+0.15*D.def)*(0.85+Math.random()*0.3);
    if(atk>def){
      const remain=Math.max(1, Math.floor(send - def/(1+0.15*A.ind)));
      D.owner=0; D.troops=remain; logMsg('âœ… Ø§Ù†ØªØµØ±Øª ÙˆØ³ÙŠØ·Ø±Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ….');
    }else{
      const loss=Math.max(1, Math.floor(atk/(1+0.15*D.def)));
      D.troops=Math.max(0, D.troops - loss); logMsg('âŒ Ø§Ù„Ù‡Ø¬ÙˆÙ… ÙØ´Ù„ Ø¬Ø²Ø¦ÙŠÙ‹Ø§.');
    }
    checkWin(); refresh();
  };

  btnEnd.onclick=()=>{
    // Ø¯Ø®Ù„Ùƒ
    goldP += income(0);
    for(const p of prov) if(p.owner===0 && Math.random()<0.25) p.troops++;

    // Ø¯ÙˆØ± Ø§Ù„Ø®ØµÙ…
    aiTurn();

    turn++; logMsg('Ø¨Ø¯Ø£ Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯.'); refresh();
  };

  btnNew.onclick=()=>{ newGame(); };

  // ===== ÙÙˆØ²/Ø®Ø³Ø§Ø±Ø© =====
  function checkWin(){
    const {cP,cA}=counts();
    if(cP>=6){ logMsg('ğŸ† ÙÙˆØ² â€” Ø³ÙŠØ·Ø±Øª Ø¹Ù„Ù‰ Ø£ØºÙ„Ø¨ Ø§Ù„Ø£Ù‚Ø§Ù„ÙŠÙ…!'); disableAll(); }
    if(cA>=6){ logMsg('ğŸ’€ Ø®Ø³Ø§Ø±Ø© â€” Ø§Ù„Ø®ØµÙ… ØªÙ…Ø¯Ø¯!'); disableAll(); }
  }
  function disableAll(){
    btnTrain.disabled=btnInvest.disabled=btnAttack.disabled=btnEnd.disabled=true;
    regs.forEach(r=>r.style.pointerEvents='none');
  }

  // ===== Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®ØµÙ… Ø¨Ø³ÙŠØ· =====
  function aiTurn(){
    goldA += income(1);
    // ÙŠØ­Ø§ÙˆÙ„ ÙŠÙ‡Ø§Ø¬Ù… Ø£Ø¶Ø¹Ù Ø¬Ø§Ø±
    let moves=[];
    for(let i=0;i<9;i++) if(prov[i].owner===1){
      for(const j of adj[i]) if(prov[j].owner!==1){
        moves.push({from:i,to:j});
      }
    }
    moves.sort((A,B)=> prov[A.to].troops - prov[B.to].troops);
    let acted=false;
    for(const m of moves){
      const a=prov[m.from], d=prov[m.to];
      if(a.troops>=3 && Math.random()<0.8){
        const send=Math.max(1, Math.floor(a.troops/2));
        a.troops-=send;
        const atk = send*(1+0.15*a.ind)*(0.85+Math.random()*0.3);
        const def = d.troops*(1+0.15*d.def)*(0.85+Math.random()*0.3);
        if(atk>def){
          const remain=Math.max(1, Math.floor(send - def/(1+0.15*a.ind)));
          d.owner=1; d.troops=remain; logMsg('âš ï¸ Ø§Ù„Ø®ØµÙ… Ø³ÙŠØ·Ø± Ø¹Ù„Ù‰ Ø¥Ù‚Ù„ÙŠÙ….');
        }else{
          const loss=Math.max(1, Math.floor(atk/(1+0.15*d.def)));
          d.troops=Math.max(0, d.troops - loss); logMsg('Ø§Ù„Ø®ØµÙ… Ù‡Ø§Ø¬Ù… ÙˆÙØ´Ù„ Ø¬Ø²Ø¦ÙŠÙ‹Ø§.');
        }
        acted=true; break;
      }
    }
    if(!acted){
      // Ø§Ø³ØªØ«Ù…Ø§Ø±/ØªØ¯Ø±ÙŠØ¨
      const aiIdx = prov.map((p,i)=>[p,i]).filter(x=>x[0].owner===1).map(x=>x[1]);
      if(aiIdx.length){
        const k=aiIdx[Math.floor(Math.random()*aiIdx.length)];
        const p=prov[k];
        if(goldA>=6 && Math.random()<0.5){ p.ind++; goldA-=6; }
        else if(goldA>=5){ p.troops+=2; goldA-=5; }
        else if(Math.random()<0.3){ p.troops++; }
      }
    }
    checkWin();
  }

  // ===== Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© =====
  function newGame(){
    prov = Array.from({length:9}, (_,i)=>({
      owner: i%3===0?0 : (i%3===1?1:2),
      troops: 2 + (i%3===0?2:0),
      ind: (i%4===0)?2:1,
      def: (i%5===0)?2:1,
      pop: 2 + (i%3===2?1:0)
    }));
    regs.forEach(r=>r.style.pointerEvents='auto');
    goldP=14; goldA=14; turn=1; from=null; to=null;
    logMsg('Ø¨Ø¯Ø§ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©.'); refresh();
  }

  // ===== Ø¨Ø¯Ø¡ =====
  refresh(); logMsg('Ø¬Ø§Ù‡Ø²: Ø§Ø®ØªØ± Ø¥Ù‚Ù„ÙŠÙ…Ùƒ Ø«Ù… Ø¬Ø§Ø±Ù‹Ø§ Ù„Ù„Ù‡Ø¬ÙˆÙ… Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… ØªØ¯Ø±ÙŠØ¨/Ø§Ø³ØªØ«Ù…Ø§Ø±.');
})();
</script>
</body>
</html>
